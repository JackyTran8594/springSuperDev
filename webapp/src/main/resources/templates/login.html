<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Digital Workshop Planner - Login</title>

    <!-- Global stylesheets -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700,900" rel="stylesheet" type="text/css">
    <link href="assets/css/icons/icomoon/styles.css" rel="stylesheet" type="text/css">
    <link href="assets/css/bootstrap.css" rel="stylesheet" type="text/css">
    <link href="assets/css/core.css" rel="stylesheet" type="text/css">
    <link href="assets/css/components.css" rel="stylesheet" type="text/css">
    <link href="assets/css/colors.css" rel="stylesheet" type="text/css">
    <!-- /global stylesheets -->

    <!-- color picker -->
    <!-- <link type="text/css" rel="stylesheet" href="assets/css/colorpicker/demo.css"> -->

    <link type="text/css" rel="stylesheet" href="assets/css/colorpicker/evol-colorpicker.css">
    <!-- /color picker -->


    <!-- Core JS files -->
    <script type="text/javascript" src="assets/js/plugins/loaders/pace.min.js"></script>
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js" type="text/javascript"></script> -->
    <script type="text/javascript" src="assets/js/core/libraries/jquery.min.js"></script>
    <script type="text/javascript" src="assets/js/core/libraries/bootstrap.min.js"></script>
    <script type="text/javascript" src="assets/js/plugins/loaders/blockui.min.js"></script>
    <script type="text/javascript" src="assets/js/plugins/ui/nicescroll.min.js"></script>
    <script type="text/javascript" src="assets/js/plugins/ui/drilldown.js"></script>
    <script type="text/javascript" src="assets/js/bootstrap-select.js"></script>
    <!-- /core JS files -->

    <!-- Theme JS files -->
    <script type="text/javascript" src="/assets/js/plugins/forms/validation/validate.min.js"></script>
    <script type="text/javascript" src="/assets/js/plugins/forms/selects/select2.min.js"></script>
    <script type="text/javascript" src="assets/js/plugins/forms/styling/uniform.min.js"></script>

    <script type="text/javascript" src="assets/js/core/app.js"></script>
    <script type="text/javascript" src="assets/js/pages/login.js"></script>


    <script type="text/javascript" src="assets/js/plugins/ui/ripple.min.js"></script>
    <script type="text/javascript" src="/wsplanning/common.js"></script>
    <script type="text/javascript" src="/wsplanning/forgot_password_modal.js"></script>
    <!-- /theme JS files -->

    <!-- color picker -->
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="/assets/js/plugins/colorpicker/evol-colorpicker.min.js"></script>
    <!-- /color picker -->

    <style>
        .userNameEmail {
            color: blue;
            text-decoration: underline;
        }


        .has-feedback-left .bootstrap-select {
            padding-right: 0 !important;
            padding-left: 32px;
        }

        .media-left img{
            width: 15px !important;
            height: 15px !important;
        }

    </style>

</head>

<body class="login-container bg-slate-800">

    <!-- Page container -->
    <div class="page-container">

        <!-- Page content -->
        <div class="page-content">

            <!-- Main content -->
            <div class="content-wrapper">

                <!-- Advanced login -->
                <form th:action="@{/login}" class="formValidate" method="POST" id="frmLogin">
                    <div class="panel panel-body login-form">
                        <div class="text-center">
                            <img src="/assets/images/Cael_logo.png" alt="Digital Workshop Planner" style="width: 50%;" />
                            <!--<div class="icon-object border-primary-400 text-primary-400"><i class="icon-people"></i></div>-->
                            <h5 class="content-group-lg"> Digital Workshop Planner
                                <small class="display-block">Login to your account</small>
                            </h5>
                        </div>

                        <div class="form-group has-feedback has-feedback-left">
                            <input type="text" class="form-control" placeholder="Username" name="username" id="username"
                                required="required" autofocus onkeypress="checkSubmit(event)">
                            <div class="form-control-feedback">
                                <i class="icon-user text-muted"></i>
                            </div>
                        </div>

                        <div class="form-group has-feedback has-feedback-left">
                            <input type="password" class="form-control" placeholder="Password" name="password" required="required"
                                onkeypress="checkSubmit(event)">
                            <div class="form-control-feedback">
                                <i class="icon-lock2 text-muted"></i>
                            </div>
                        </div>

                        <div class="form-group has-feedback has-feedback-left">
                            <select class="form-control" placeholder="siteId" name="siteId" required="required" id="siteId"></select>
                            <div class="form-control-feedback">
                                <i class="icon-cog text-muted"></i>
                            </div>
                        </div>


                        <div class="form-group has-feedback has-feedback-left">
                            <select class="form-control selectpicker" placeholder="language" name="language" required="required"
                                id="language">
                                <option value="en" data-thumbnail="/assets/images/flags/us.png">English</option>
                                <option value="vi" data-thumbnail="/assets/images/flags/vi.png">Viá»‡t nam</option>
                            </select>
                            <div class="form-control-feedback">
                                <i class="icon-sphere text-muted"></i>
                            </div>
                        </div>

                        <div class="form-group">
                            <div id="cpEvent" class="form-control">
                                <input id="cpBinding" type="text" /><br />
                            </div>
                        </div>
                        <!--<div class="form-group">-->
                        <!--<a href="javascript:void(0)" class="forgotPasswordBtn">Forgot your account</a>-->
                        <!--</div>-->
                        <!--<div class="form-group login-options">-->
                        <!--<div class="row">-->
                        <!--<div class="col-sm-6">-->
                        <!--<label class="checkbox-inline">-->
                        <!--<input type="checkbox" class="styled" checked="checked">-->
                        <!--Remember-->
                        <!--</label>-->
                        <!--</div>-->

                        <!--<div class="col-sm-6 text-right">-->
                        <!--<a href="login_password_recover.html">Forgot password?</a>-->
                        <!--</div>-->
                        <!--</div>-->
                        <!--</div>-->

                        <div class="alert alert-danger no-border loginError" style="display: none">
                            <button type="button" class="close" data-dismiss="alert"><span>&times;</span><span class="sr-only">Close</span></button>
                            <span class="text-semibold">Login failed!</span> </br>Username or password is wrong.
                        </div>

                        <div class="form-group">
                            <button type="button" class="btn btn-primary btn-block" onclick='onLogin()' id="btnLogin">Login
                                <i class="icon-circle-right2 position-right"></i></button>
                        </div>

                    </div>
                </form>
                <!-- /advanced login -->

            </div>
            <!-- /main content -->

        </div>
        <!-- /page content -->

    </div>
    <!-- /page container -->

    <div th:replace="users/forgot_password_modal::forgotPassword"></div>
    <div th:replace="users/confirm_forgot_password_modal::confirmForgotPassword"></div>

    <script type="text/javascript">
        $(document).ready(function () {
            $.ajax({
                type: 'GET',
                url: '/site/getAll',
                dataType: 'json',
                success: function (responseData, textStatus, jqXHR) {
                    $.each(responseData, function (i, item) {
                        $('#siteId').append($('<option>', {
                            value: item.Id,
                            text: item.Name
                        }));
                    });
                },
                error: function (responseData, textStatus, errorThrown) {
                    console.log(responseData);
                    console.log(errorThrown);
                }
            });

            $.ajax({
                type: 'GET',
                url: '/language/getAll',
                dataType: 'json',
                success: function (responseData, textStatus, jqXHR) {
                    var option = "";
                    $('#language').html("");
                    $.each(responseData, function (i, item) {
                        var CultureInfo = item.CultureInfo;
                        var tmp = CultureInfo.split("-");
                        option = "";
                        option += "<option value=\"" + tmp[0] + "\" data-thumbnail=\"/assets/images/flags/" + item.Flag.toLowerCase() + "\">" + item.Name + "</option>";
                        $('#language').append(option);
                    });
                },
                error: function (responseData, textStatus, errorThrown) {
                    console.log(responseData);
                    console.log(errorThrown);
                }
            });
        });



        function checkSubmit(e) {
            if (e.keyCode == 13) {
                onLogin();
            }
        }



        function onLogin() {
            if ($("#frmLogin").valid()) {
                var username = $("#username").val();
                var siteId = $("#siteId").val();
                var colorCode = $("#cpBinding").val();
                // console.log(username);
                // console.log(siteId);
                // console.log(colorCode);
                var objectJson = {
                    username: username,
                    siteId: siteId,
                    colorCode: colorCode
                }

                var myObjectArray = [];
                myObjectArray.push(objectJson)
                localStorage.setItem("colorPicker", JSON.stringify(myObjectArray));

                // function checkLocalStorage() {
                //     var objArray = JSON.parse(localStorage.getItem("colorPicker"));
                //     var count = 0;
                //     if (objArray == null) {
                //         localStorage.setItem("colorPicker", JSON.stringify(myObjectArray));
                //     } else {
                //         objArray.forEach(item => {
                //             if (item.username == objectJson.username && item.siteId == objectJson.siteId) {
                //                 item.colorCode = objectJson.colorCode;
                //             } else {
                //                 count++;
                //             }
                //         });
                //         if (count > 0) {
                //             objArray.push(objectJson);
                //         }
                //     }
                // }

                common.btnLoading($("#btnLogin"), true);
                $("#frmLogin").submit();

            }
        }

        $(document).ready(function () {
            function setColor(evt, color) {
                if (color) {
                    $('#cpEvent').css('background-color', color);

                }
            }

            $('#cpBinding').colorpicker({
                color: '#ebf1dd',
                initialHistory: ['#ff0000', '#000000', 'red', 'purple']
            }).on('change.color', setColor).on('mouseover.color', setColor);

            // Instanciate colorpickers
            $('#cpBinding').colorpicker({
                color: '#ebf1dd'
            })

        })


    </script>
</body>

</html>